<style>
    /* ===== LAYOUT GERAL ===== */
    h1 {
    margin-bottom: 5px;
    }

    p {
    color: #555;
    margin-bottom: 15px;
    }

    hr {
    margin: 25px 0;
    border: none;
    border-top: 1px solid #ddd;
    }

    .actions {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
    }

    /* ===== BOT√ïES ===== */
    button,
    .btn-add,
    .btn-success,
    .btn-danger,
    .btn-secondary {
    padding: 6px 12px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    font-size: 14px;
    }

    .btn-add {
    background: #eef5ff;
    color: #1a73e8;
    }

    .btn-success {
    background: #28a745;
    color: #fff;
    }

    .btn-danger {
    background: #dc3545;
    color: #fff;
    }

    .btn-secondary {
    background: #f1f1f1;
    color: #333;
    text-decoration: none;
    }

    /* ===== SE√á√ïES ===== */
    .section {
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 15px;
    }

    .section .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
    }

    /* ===== TABELAS ===== */
    .schema-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
    }

    .schema-table th {
    background: #f5f6f8;
    text-align: left;
    padding: 8px;
    border-bottom: 1px solid #ddd;
    }

    .schema-table td {
    padding: 8px;
    border-bottom: 1px solid #eee;
    }

    .schema-table tr:hover {
    background: #fafafa;
    }

    .empty {
    text-align: center;
    color: #888;
    }

    /* ===== PAIN√âIS (MODAL SIMPLES) ===== */
    .panel {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #fff;
    width: 420px;
    padding: 20px;
    border-radius: 10px;
    border: 1px solid #ccc;
    z-index: 999;
    box-shadow: 0 10px 30px rgba(0,0,0,.15);
    }

    .panel h3 {
    margin-top: 0;
    }

    .panel label {
    display: block;
    margin-top: 10px;
    font-weight: 500;
    }

    .panel input,
    .panel select {
    width: 100%;
    padding: 6px;
    margin-top: 4px;
    }

    .checks {
    margin-top: 10px;
    }

    .checks label {
    display: block;
    }

    .panel-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 15px;
    }

    /* ===== UTIL ===== */
    .hidden {
    display: none;
    }

</style>


<h1>üìä Tabela: {{table.name}}</h1>
<p>Projeto: <strong>{{project.name}}</strong></p>

<div class="actions">
  <a href="/admin/tables?project_id={{project.id}}" class="btn-secondary">‚¨Ö Voltar</a>

  <form method="POST" action="/admin/tables/delete" style="display:inline"
        onsubmit="return confirm('Deseja realmente deletar esta tabela?')">
    <input type="hidden" name="project_id" value="{{project.id}}">
    <input type="hidden" name="table" value="{{table.name}}">
    <button class="btn-danger">üóë Deletar Tabela</button>
  </form>
</div>

<hr>

<!-- ===================== COLUNAS ===================== -->
<div class="section">
  <div class="header">
    <h3>üìÑ Colunas</h3>
    <button class="btn-add" onclick="openColumnPanel()">‚ûï Nova Coluna</button>
  </div>

  <table class="schema-table">
    <thead>
      <tr>
        <th>Nome</th>
        <th>Tipo</th>
        <th>Nullable</th>
        <th>Unique</th>
        <th>A√ß√µes</th>
      </tr>
    </thead>
    <tbody>
      {{#if table.columns.length}}
        {{#each table.columns}}
        <tr>
          <td>{{this.name}}</td>
          <td>{{this.type}}</td>
          <td>{{#if this.nullable}}‚úîÔ∏è{{else}}‚ùå{{/if}}</td>
          <td>{{#if this.unique}}‚úîÔ∏è{{else}}‚ùå{{/if}}</td>
          <td>
            <button onclick="editColumn('{{this.name}}','{{this.type}}',{{this.nullable}},{{this.unique}})">
              ‚úèÔ∏è
            </button>

            <form method="POST" action="/admin/tables/column/drop" style="display:inline"
                  onsubmit="return confirm('Remover coluna {{this.name}}?')">
              <input type="hidden" name="project_id" value="{{../project.id}}">
              <input type="hidden" name="table" value="{{../table.name}}">
              <input type="hidden" name="column" value="{{this.name}}">
              <button>üóë</button>
            </form>
          </td>
        </tr>
        {{/each}}
      {{else}}
        <tr>
          <td colspan="5" class="empty">Nenhuma coluna encontrada</td>
        </tr>
      {{/if}}
    </tbody>
  </table>
</div>

<hr>

<!-- ===================== √çNDICES ===================== -->
<div class="section">
  <div class="header">
    <h3>üì¶ √çndices</h3>
    <button class="btn-add" onclick="openIndexPanel()">‚ûï Novo √çndice</button>
  </div>

  <table class="schema-table">
    <thead>
      <tr>
        <th>Nome</th>
        <th>Tipo</th>
        <th>Colunas</th>
        <th>A√ß√µes</th>
      </tr>
    </thead>
    <tbody>
      {{#if table.indexes.length}}
        {{#each table.indexes}}
        <tr>
          <td>{{this.name}}</td>
          <td>{{this.type}}</td>
          <td>{{this.columns}}</td>
          <td>
            <form method="POST" action="/admin/tables/index/drop" style="display:inline"
                  onsubmit="return confirm('Remover √≠ndice {{this.name}}?')">
              <input type="hidden" name="project_id" value="{{../project.id}}">
              <input type="hidden" name="table" value="{{../table.name}}">
              <input type="hidden" name="index" value="{{this.name}}">
              <button>üóë</button>
            </form>
          </td>
        </tr>
        {{/each}}
      {{else}}
        <tr>
          <td colspan="4" class="empty">Nenhum √≠ndice criado</td>
        </tr>
      {{/if}}
    </tbody>
  </table>
</div>

<!-- ===================== PAINEL COLUNA ===================== -->
<div id="column-panel" class="panel hidden">
  <h3 id="column-panel-title">Nova Coluna</h3>

  <form method="POST" action="/admin/tables/column/add" id="column-form">
    <input type="hidden" name="project_id" value="{{project.id}}">
    <input type="hidden" name="table" value="{{table.name}}">

    <label>Nome</label>
    <input name="name" id="col-name" required>

    <label>Tipo</label>
    <input name="type" id="col-type" required placeholder="VARCHAR(255), INT...">

    <div class="checks">
      <label><input type="checkbox" name="nullable" id="col-nullable"> Nullable</label>
      <label><input type="checkbox" name="unique" id="col-unique"> Unique</label>
    </div>

    <div class="panel-actions">
      <button class="btn-success">Salvar</button>
      <button type="button" onclick="closePanel()" class="btn-cancel">Cancelar</button>
    </div>
  </form>
</div>

<!-- ===================== PAINEL √çNDICE ===================== -->
<div id="index-panel" class="panel hidden">
  <h3>Novo √çndice</h3>

  <form method="POST" action="/admin/tables/index/add">
    <input type="hidden" name="project_id" value="{{project.id}}">
    <input type="hidden" name="table" value="{{table.name}}">

    <label>Nome</label>
    <input name="name" required>

    <label>Tipo</label>
    <select name="type">
      <option value="INDEX">INDEX</option>
      <option value="UNIQUE">UNIQUE</option>
    </select>

    <label>Colunas</label>
    <select name="columns" multiple required>
      {{#each table.columns}}
        <option value="{{this.name}}">{{this.name}}</option>
      {{/each}}
    </select>

    <div class="panel-actions">
      <button class="btn-success">Salvar</button>
      <button type="button" onclick="closeIndexPanel()" class="btn-cancel">Cancelar</button>
    </div>
  </form>
</div>

<script>
  function openColumnPanel() {
    document.getElementById("column-form").action = "/admin/tables/column/add";
    document.getElementById("column-panel-title").innerText = "Nova Coluna";
    document.getElementById("col-name").value = "";
    document.getElementById("col-type").value = "";
    document.getElementById("col-nullable").checked = false;
    document.getElementById("col-unique").checked = false;
    document.getElementById("column-panel").classList.remove("hidden");
  }

  function editColumn(name, type, nullable, unique) {
    document.getElementById("column-form").action = "/admin/tables/column/update";
    document.getElementById("column-panel-title").innerText = "Editar Coluna";
    document.getElementById("col-name").value = name;
    document.getElementById("col-type").value = type;
    document.getElementById("col-nullable").checked = nullable;
    document.getElementById("col-unique").checked = unique;
    document.getElementById("column-panel").classList.remove("hidden");
  }

  function closePanel() {
    document.getElementById("column-panel").classList.add("hidden");
  }

  function openIndexPanel() {
    document.getElementById("index-panel").classList.remove("hidden");
  }

  function closeIndexPanel() {
    document.getElementById("index-panel").classList.add("hidden");
  }
</script>
